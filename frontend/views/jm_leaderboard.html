<div v-if="currentTab === 'jm_leaderboard'" class="view-content pb-24 space-y-8 animate-fade-in">
    <!-- Header -->
    <div class="flex items-start justify-between gap-4">
        <div class="min-w-0 space-y-1">
            <h2 class="headline-medium font-bold text-on-surface flex items-center gap-3">
                <span class="material-symbols-rounded text-primary filled-icon text-4xl">leaderboard</span>
                JM 排行榜
            </h2>
            <p class="text-body-large text-on-surface-variant/80">
                评分最高和浏览最多的图集
            </p>
        </div>
        <div class="flex items-center gap-2">
            <button @click="loadJmLeaderboard(1)" :disabled="jmLeaderboardLoading"
                class="md-icon-btn bg-surface-container-high hover:bg-primary hover:text-on-primary rounded-full"
                title="刷新">
                <span class="material-symbols-rounded" :class="jmLeaderboardLoading ? 'animate-spin' : ''">refresh</span>
            </button>
            <button @click="currentTab = 'home'"
                class="md-icon-btn bg-surface-container-high hover:bg-primary hover:text-on-primary rounded-full"
                title="返回首页">
                <span class="material-symbols-rounded">arrow_back</span>
            </button>
        </div>
    </div>

    <!-- Filters -->
    <div class="md-card p-4 md:p-6 bg-surface-container-low border-0 space-y-4">
        <!-- Sort Options -->
        <div class="flex gap-2 overflow-x-auto max-w-full pb-2 no-scrollbar mask-linear-fade">
            <button v-for="o in jmLeaderboardSortOptions" :key="o.value"
                @click="setJmLeaderboardSort(o.value)"
                class="md-chip h-10 px-5 text-sm font-medium whitespace-nowrap transition-all duration-300"
                :class="jmLeaderboardSort === o.value ? 'bg-primary text-on-primary shadow-lg shadow-primary/30' : 'hover:bg-surface-container-high'">
                {{ o.label }}
            </button>
        </div>
        
        <!-- Categories -->
        <div class="flex gap-2 overflow-x-auto max-w-full pb-2 no-scrollbar mask-linear-fade border-t border-outline-variant/10 pt-4">
            <button v-for="c in jmCategories" :key="String(c.CID || c.id || c.name || c.title || c)"
                @click="setJmLeaderboardCategory(getJmCategoryId(c))"
                class="md-chip h-10 px-5 text-sm font-medium whitespace-nowrap transition-all duration-300"
                :class="jmLeaderboardCategory === getJmCategoryId(c) ? 'bg-primary text-on-primary shadow-lg shadow-primary/30' : 'hover:bg-surface-container-high'">
                {{ getJmCategoryTitle(c) }}
            </button>
        </div>
    </div>

    <!-- Loading & Error -->
    <loading-state :loading="jmLeaderboardLoading && jmLeaderboardItems.length === 0">
        <span class="mt-4 text-body-medium text-on-surface-variant">加载排行榜中...</span>
    </loading-state>

    <error-state :error="jmLeaderboardError" @retry="loadJmLeaderboard(1)"></error-state>

    <!-- Empty State -->
    <div v-if="!jmLeaderboardLoading && !jmLeaderboardError && jmLeaderboardItems.length === 0" class="flex flex-col items-center justify-center py-24 opacity-60">
        <span class="material-symbols-rounded text-8xl text-outline-variant mb-4">emoji_events</span>
        <p class="headline-small text-on-surface-variant">暂无排行数据</p>
        <p class="text-body-medium mt-2 text-on-surface-variant/70">尝试更改时间范围或分类</p>
    </div>

    <!-- Content Grid -->
    <div v-if="jmLeaderboardItems.length > 0" class="space-y-8">
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6">
            <book-card 
                v-for="(book, index) in jmLeaderboardItems" 
                :key="book.album_id" 
                :book="book" 
                @click="viewDetails">
            </book-card>
        </div>

        <div class="flex flex-col items-center gap-4">
             <div v-if="jmLeaderboardLoading && jmLeaderboardItems.length" class="flex items-center justify-center py-6 opacity-60">
                <span class="material-symbols-rounded text-4xl animate-spin text-primary">progress_activity</span>
            </div>
            <div v-else-if="!jmLeaderboardHasMore" class="text-center text-label-medium opacity-60 py-4 uppercase tracking-widest">到底了</div>

            <pagination-controls 
                v-if="!jmLeaderboardLoading"
                :page="jmLeaderboardPage" 
                :loading="jmLeaderboardLoading" 
                :has-more="jmLeaderboardHasMore"
                @prev="loadJmLeaderboard(jmLeaderboardPage - 1)" 
                @next="loadJmLeaderboard(jmLeaderboardPage + 1)">
            </pagination-controls>
        </div>
    </div>
</div>
