    <!-- Search View -->
    <transition name="fade" mode="out-in" v-cloak>
        <div v-if="currentTab === 'search'" class="min-h-screen pb-24">
            <transition
                enter-active-class="transition duration-200 ease-out"
                enter-from-class="transform -translate-y-2 scale-[0.98] opacity-0"
                enter-to-class="transform translate-y-0 scale-100 opacity-100"
                leave-active-class="transition duration-150 ease-in"
                leave-from-class="transform translate-y-0 scale-100 opacity-100"
                leave-to-class="transform -translate-y-2 scale-[0.98] opacity-0"
            >
                <div v-if="searchStickyActive" class="sticky top-0 z-[120] lg:hidden">
                    <div class="px-4 py-3 bg-surface border-b border-outline-variant/20 shadow-sm">
                        <div class="w-full max-w-2xl mx-auto">
                            <div class="flex items-center gap-3 min-w-0">
                                <div class="flex-1 min-w-0">
                                    <div class="md-input-container w-full flex items-center gap-3 px-5 py-3 shadow-lg ring-2 ring-transparent focus-within:ring-primary/20 bg-surface-container-high rounded-full">
                                        <span class="material-symbols-rounded text-on-surface-variant text-xl">search</span>
                                        <input v-model="searchQuery" @keyup.enter="search" type="text" placeholder="搜索标题、作者或 ID..." 
                                            class="md-input flex-1 min-w-0 text-base bg-transparent border-none focus:ring-0 placeholder:text-on-surface-variant/50 outline-none">
                                        <button @click="search" class="w-10 h-10 bg-primary text-on-primary hover:bg-primary/90 flex items-center justify-center shadow-sm rounded-full active:scale-95 transition">
                                            <span class="material-symbols-rounded text-[20px]">arrow_forward</span>
                                        </button>
                                    </div>
                                    <div v-if="source === 'jm' && String(jmSearchCategory || '0') !== '0'" class="mt-2 px-2 text-xs font-medium text-on-surface-variant flex items-center gap-2">
                                        <span class="material-symbols-rounded text-primary text-base">filter_alt</span>
                                        筛选: <span class="font-bold text-on-surface">{{ jmSearchCategoryTitle }}</span>
                                        <button @click="setJmSearchCategory({slug:'0',name:'全部',title:'全部'})"
                                            class="ml-auto text-xs font-bold text-primary hover:text-primary/80 transition uppercase tracking-wide px-3 py-1 rounded-full hover:bg-primary/5">
                                            清除
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <!-- Search Header -->
            <div class="flex flex-col items-center gap-8 py-12 md:py-24 px-4">
                <h1 class="text-3xl md:text-6xl font-normal tracking-tight text-center text-on-surface">
                    探索 <span class="text-primary font-medium italic">漫画</span>
                </h1>
                
                <div class="w-full max-w-2xl relative group z-20">
                    <div class="absolute inset-0 bg-primary/20 blur-3xl rounded-full opacity-0 group-focus-within:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
                    <div class="md-input-container w-full flex items-center gap-4 px-6 py-4 shadow-xl hover:shadow-2xl transition-all duration-300 ring-4 ring-transparent focus-within:ring-primary/20 bg-surface-container-high rounded-full">
                        <span class="material-symbols-rounded text-on-surface-variant text-2xl">search</span>
                        <input v-model="searchQuery" @keyup.enter="search" type="text" placeholder="搜索标题、作者或 ID..." 
                            class="md-input flex-1 min-w-0 text-lg bg-transparent border-none focus:ring-0 placeholder:text-on-surface-variant/50 outline-none">
                        <button @click="search" class="md-icon-btn w-12 h-12 bg-primary text-on-primary hover:bg-primary/90 flex items-center justify-center shadow-md rounded-full">
                            <span class="material-symbols-rounded">arrow_forward</span>
                        </button>
                    </div>
                </div>

                <div v-if="source === 'jm'" class="w-full max-w-3xl space-y-4">
                    <div class="flex items-center justify-between gap-3 px-2">
                        <div class="text-sm font-medium text-on-surface-variant flex items-center gap-2">
                            <span class="material-symbols-rounded text-primary text-lg">filter_alt</span>
                            筛选: <span class="font-bold text-on-surface">{{ jmSearchCategoryTitle }}</span>
                        </div>
                        <button @click="setJmSearchCategory({slug:'0',name:'全部',title:'全部'})"
                            class="text-xs font-bold text-primary hover:text-primary/80 transition uppercase tracking-wide px-3 py-1 rounded-full hover:bg-primary/5">
                            清除筛选
                        </button>
                    </div>
                    
                    <div class="flex gap-2 overflow-x-auto max-w-full pb-4 px-2 no-scrollbar mask-gradient-x">
                        <button v-for="c in jmCategories" :key="String(c.slug || c.id || c.name || c.title || c)"
                            @click="setJmSearchCategory(c)"
                            class="md-chip h-9 px-4 text-sm whitespace-nowrap transition-all duration-200 active:scale-95 shadow-sm"
                            :class="jmSearchCategory === getJmCategoryId(c) ? 'md-chip-selected bg-secondary-container text-on-secondary-container border-transparent' : 'bg-surface-container hover:bg-surface-container-high'">
                            {{ getJmCategoryTitle(c) }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div v-if="loading" class="flex flex-col items-center justify-center py-20 opacity-50">
                <div class="w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin mb-4"></div>
                <p class="font-medium text-on-surface-variant">正在搜索...</p>
            </div>

            <!-- Results Grid -->
            <div v-else class="px-4 md:px-8 max-w-[1600px] mx-auto w-full">
                <div v-if="searchResults.length === 0 && !loading && searchQuery" class="text-center py-20 opacity-60">
                    <span class="material-symbols-rounded text-6xl text-outline mb-4">sentiment_dissatisfied</span>
                    <p class="text-xl font-medium text-on-surface-variant">未找到相关结果</p>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4 md:gap-6">
                    <div v-for="item in searchResults" :key="item.album_id" 
                         class="md-card cursor-pointer group flex flex-col h-full"
                         @click="viewDetails(item.album_id)">
                        <div class="aspect-[3/4] overflow-hidden relative bg-surface-container-high">
                             <img :src="getCoverUrl(item)" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy" alt="Cover">
                             
                              <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
                                  <span class="w-12 h-12 rounded-full bg-primary text-on-primary flex items-center justify-center shadow-xl transform translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300 delay-100">
                                    <span class="material-symbols-rounded">arrow_outward</span>
                                  </span>
                             </div>
                        </div>
                        
                        <div class="p-4 flex flex-col flex-1 gap-2">
                            <h3 class="font-bold text-base line-clamp-2 leading-tight group-hover:text-primary transition-colors">{{ item.title }}</h3>
                            <div class="mt-auto flex items-center justify-between opacity-70">
                                <p class="text-xs truncate max-w-[60%] text-on-surface-variant flex items-center gap-1">
                                    {{ item.author }}
                                </p>
                                <span class="text-[10px] font-bold px-2 py-1 bg-surface-container-highest rounded-full text-on-surface-variant">{{ item.category }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pagination -->
                <div v-if="searchResults.length > 0" class="flex justify-center items-center gap-6 py-12">
                     <button @click="changePage(-1)" :disabled="currentPage <= 1" 
                        class="w-12 h-12 rounded-full bg-surface-container-high text-on-surface flex items-center justify-center disabled:opacity-30 hover:bg-primary hover:text-on-primary transition shadow-sm">
                        <span class="material-symbols-rounded">arrow_back</span>
                     </button>
                     <span class="text-lg font-medium font-mono opacity-80">第 {{ currentPage }} 页</span>
                     <button @click="changePage(1)" 
                        class="w-12 h-12 rounded-full bg-surface-container-high text-on-surface flex items-center justify-center hover:bg-primary hover:text-on-primary transition shadow-sm">
                        <span class="material-symbols-rounded">arrow_forward</span>
                     </button>
                </div>
            </div>
        </div>
    </transition>
