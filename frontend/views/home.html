    <!-- Home View -->
    <transition name="fade" mode="out-in" @after-enter="restoreHomeScroll" v-cloak>
        <div v-if="currentTab === 'home'" class="space-y-8 pb-20">
            <transition name="home-topbar">
                <div v-if="homeTopbarVisible" class="fixed top-0 left-0 right-0 z-[120] pt-[env(safe-area-inset-top)] lg:hidden">
                    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 lg:pl-24">
                        <div class="mt-3 md-card border-0 bg-surface/80 backdrop-blur-md shadow-xl shadow-black/5">
                            <div class="h-14 px-4 flex items-center justify-between gap-3">
                                <div class="flex items-center gap-2 min-w-0">
                                    <span class="material-symbols-rounded text-primary">menu_book</span>
                                    <div class="font-bold text-sm text-on-surface truncate">JM</div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button v-if="source === 'jm'" type="button" @click="currentTab = 'jm_latest'"
                                        class="h-10 px-3 rounded-full bg-surface-container hover:bg-surface-container-high transition text-sm font-semibold flex items-center gap-2">
                                        <span class="material-symbols-rounded text-primary">new_releases</span>
                                        最新
                                    </button>
                                    <button v-if="source === 'jm'" type="button" @click="currentTab = 'jm_categories'"
                                        class="h-10 px-3 rounded-full bg-surface-container hover:bg-surface-container-high transition text-sm font-semibold flex items-center gap-2">
                                        <span class="material-symbols-rounded text-primary">category</span>
                                        分类
                                    </button>
                                    <button v-if="source === 'jm'" type="button" @click="currentTab = 'jm_leaderboard'"
                                        class="h-10 px-3 rounded-full bg-surface-container hover:bg-surface-container-high transition text-sm font-semibold flex items-center gap-2">
                                        <span class="material-symbols-rounded text-primary">leaderboard</span>
                                        排行
                                    </button>
                                    <button v-if="source === 'jm'" type="button" @click="currentTab = 'jm_history'"
                                        class="h-10 px-3 rounded-full bg-surface-container hover:bg-surface-container-high transition text-sm font-semibold flex items-center gap-2">
                                        <span class="material-symbols-rounded text-primary">history</span>
                                        历史
                                    </button>
                                    <button type="button" @click="refreshHomeData"
                                        class="w-10 h-10 rounded-full bg-primary/10 text-primary hover:bg-primary/15 transition disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center"
                                        :disabled="homeRefreshing || homeLoading"
                                        title="刷新推荐">
                                        <span class="material-symbols-rounded" :class="{ 'animate-spin': homeRefreshing || homeLoading }">refresh</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <div class="flex flex-col items-center gap-4 py-8 md:py-12">
                <h1 class="relative inline-block text-4xl md:text-5xl font-normal tracking-tight text-center text-on-surface">
                    JM <span class="text-primary font-medium">Comic</span>
                    <span class="absolute -bottom-2 -right-10 text-xs font-bold text-primary bg-primary/10 px-2 py-0.5 rounded-md border border-primary/20 tracking-wider ">AURA</span>
                </h1>

                <div class="w-full max-w-2xl px-2 space-y-3">
                    <div class="flex flex-wrap items-center justify-center gap-2">
                        <button v-if="source === 'jm'" type="button" @click="currentTab = 'jm_latest'"
                            class="h-10 px-4 rounded-full bg-surface-container hover:bg-surface-container-high transition text-sm font-semibold flex items-center gap-2">
                            <span class="material-symbols-rounded text-primary">new_releases</span>
                            最新
                        </button>
                        <button v-if="source === 'jm'" type="button" @click="currentTab = 'jm_categories'"
                            class="h-10 px-4 rounded-full bg-surface-container hover:bg-surface-container-high transition text-sm font-semibold flex items-center gap-2">
                            <span class="material-symbols-rounded text-primary">category</span>
                            分类
                        </button>
                        <button v-if="source === 'jm'" type="button" @click="currentTab = 'jm_leaderboard'"
                            class="h-10 px-4 rounded-full bg-surface-container hover:bg-surface-container-high transition text-sm font-semibold flex items-center gap-2">
                            <span class="material-symbols-rounded text-primary">leaderboard</span>
                            排行
                        </button>
                        <button v-if="source === 'jm'" type="button" @click="currentTab = 'jm_history'"
                            class="h-10 px-4 rounded-full bg-surface-container hover:bg-surface-container-high transition text-sm font-semibold flex items-center gap-2">
                            <span class="material-symbols-rounded text-primary">history</span>
                            历史
                        </button>
                    </div>

                    <div class="flex items-center justify-center gap-3 text-xs text-on-surface-variant">
                        <span v-if="homeLastUpdatedAt" class="flex items-center gap-1">
                            <span class="material-symbols-rounded text-sm">schedule</span>
                            推荐更新：{{ formatTimeAgo(homeLastUpdatedAt) }}
                        </span>
                        <span v-if="!isOnline" class="px-2 py-0.5 rounded-full bg-error-container text-on-error-container border border-error/10">离线</span>
                        <button type="button" @click="refreshHomeData"
                            class="w-10 h-10 rounded-full bg-surface-container text-on-surface-variant hover:bg-primary hover:text-on-primary transition disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center"
                            :disabled="homeRefreshing || homeLoading"
                            title="刷新推荐">
                            <span class="material-symbols-rounded" :class="{ 'animate-spin': homeRefreshing || homeLoading }">refresh</span>
                        </button>
                    </div>

                    <div v-if="homeError" class="md-card p-4 border-0 bg-error-container text-on-error-container flex items-start gap-3">
                        <span class="material-symbols-rounded mt-0.5">error</span>
                        <div class="min-w-0">
                            <div class="font-bold text-sm">推荐加载失败</div>
                            <div class="text-xs opacity-80 break-words">{{ homeError }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="source === 'jm' && jmLocalHistoryItems && jmLocalHistoryItems.length" class="space-y-4">
                <div class="flex items-center gap-2 px-2">
                    <div class="flex items-center gap-2 min-w-0">
                        <div class="w-1 h-6 bg-primary rounded-full"></div>
                        <h2 class="text-xl md:text-2xl font-bold text-on-surface truncate">继续阅读</h2>
                    </div>
                </div>

                <div class="flex gap-4 overflow-x-auto pb-2 px-2 snap-x snap-mandatory">
                    <div
                        v-for="item in jmLocalHistoryItems.slice(0, 10)"
                        :key="item.album_id"
                        class="min-w-[260px] md-card p-4 border-0 bg-surface-container-low hover:bg-surface-container transition cursor-pointer snap-start"
                        @click="viewDetails(item.album_id)"
                    >
                        <div class="flex gap-3">
                            <div class="w-16 shrink-0 aspect-[3/4] overflow-hidden rounded-xl bg-surface-variant">
                                <img :src="getCoverUrlByAlbumId(item.album_id)" class="w-full h-full object-cover" loading="lazy" decoding="async" :alt="item.album_title || 'Cover'">
                            </div>
                            <div class="min-w-0 flex-1">
                                <div class="font-bold text-sm line-clamp-2 leading-tight text-on-surface">{{ item.album_title }}</div>
                                <div class="mt-1 text-xs text-on-surface-variant line-clamp-2">{{ item.title }}</div>
                                <div class="mt-3 flex items-center gap-2">
                                    <button type="button" @click.stop="resumeFromHistory(item)"
                                        class="h-9 px-4 rounded-full bg-primary text-on-primary hover:bg-primary/90 transition text-xs font-bold shadow-lg shadow-primary/20">
                                        继续
                                    </button>
                                    <button type="button" @click.stop="viewDetails(item.album_id)"
                                        class="h-9 px-4 rounded-full bg-surface-container hover:bg-surface-container-high transition text-xs font-bold">
                                        详情
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="homeLoading" class="flex flex-col items-center justify-center py-20 opacity-60">
                <span class="material-symbols-rounded text-6xl animate-spin text-primary">progress_activity</span>
                <p class="mt-4 font-medium text-on-surface-variant">Loading recommendations...</p>
            </div>

            <div v-else class="space-y-12">
                <div v-for="category in homeData" :key="category.id" class="space-y-4">
                    <div class="flex items-center gap-2 px-2">
                        <div class="w-1 h-6 bg-primary rounded-full"></div>
                        <h2 class="text-xl md:text-2xl font-bold text-on-surface">{{ category.title }}</h2>
                    </div>
                    
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
                        <div v-for="book in category.content" :key="book.id" 
                             class="md-card overflow-hidden cursor-pointer group flex flex-col h-full transition-all duration-300"
                             @click="viewDetails(book.id)">
                            <div class="aspect-[3/4] overflow-hidden relative bg-surface-variant">
                                 <img :src="getCoverUrl(book)" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" loading="lazy" decoding="async" :alt="book.name || 'Cover'">
                                 
                                  <div class="absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
                                      <span class="text-white text-xs font-bold px-2 py-1 bg-black/60 rounded-md shadow-sm">View</span>
                                 </div>
                            </div>
                            
                            <div class="p-3 flex flex-col flex-1">
                                <h3 class="font-bold text-sm line-clamp-2 leading-tight mb-1 group-hover:text-primary transition-colors">{{ book.name }}</h3>
                                <div class="mt-auto pt-2 flex items-center justify-between opacity-80">
                                    <p class="text-xs truncate max-w-[70%] text-on-surface-variant">{{ book.author }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Back to Top Button -->
            <transition name="fade">
                <button v-show="showBackToTop" @click="scrollToTop" 
                    class="fixed bottom-24 right-6 md:bottom-10 md:right-10 z-40 w-14 h-14 rounded-full bg-primary text-on-primary shadow-xl flex items-center justify-center hover:bg-primary/90 transition-transform hover:scale-110">
                    <span class="material-symbols-rounded text-3xl">arrow_upward</span>
                </button>
            </transition>
        </div>
    </transition>
